{% extends 'blog/base.html' %}
{% load static %}

{% block title %}íšŒì› íƒˆí‡´ - RhythmTag{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'blog/css/post_update.css' %}">
    <link rel="stylesheet" href="{% static 'accounts/css/profile_delete.css' %}">
{% endblock %}

{% block content %}
<div class="delete-container">
    <!-- ê²½ê³  í—¤ë” -->
    <div class="warning-header">
        <div class="warning-icon">âš ï¸</div>
        <h1 class="warning-title">#íšŒì› íƒˆí‡´</h1>
        <p class="warning-subtitle">ì •ë§ë¡œ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
    </div>

    <!-- í˜„ì¬ ê³„ì • ì •ë³´ -->
    <div class="info-section">
        <h3>ğŸ“‹ í˜„ì¬ ê³„ì • ì •ë³´</h3>
        <div style="text-align: center; margin: 20px 0;">
            <div style="display: inline-block; background: white; padding: 15px 25px; border-radius: 8px; border: 2px solid #007bff;">
                <strong>ì‚¬ìš©ì ID:</strong> 
                <span style="color: #007bff; font-size: 18px; font-weight: bold;">{{ user.userid }}</span>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number">{{ blog_count }}</div>
                <div class="stat-label">ë¸”ë¡œê·¸</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ post_count }}</div>
                <div class="stat-label">ê²Œì‹œê¸€</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ like_count }}</div>
                <div class="stat-label">ì¢‹ì•„ìš”</div>
            </div>
        </div>
    </div>

    <!-- ê²½ê³  ì‚¬í•­ -->
    <div class="warning-section">
        <h3 style="color: #dc3545; margin-top: 0;">ğŸš¨ ì¤‘ìš” ì•ˆë‚´ì‚¬í•­</h3>
        <ul class="danger-list">
            <li>ëª¨ë“  ë¸”ë¡œê·¸ì™€ ê²Œì‹œê¸€ì´ <strong>ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œ</strong>ë©ë‹ˆë‹¤</li>
            <li>ë‹¤ë¥¸ ì‚¬ìš©ì ê²Œì‹œê¸€ì— ë‚¨ê¸´ ì¢‹ì•„ìš”ê°€ <strong>ëª¨ë‘ ì·¨ì†Œ</strong>ë©ë‹ˆë‹¤</li>
            <li>ì‚­ì œëœ ë°ì´í„°ëŠ” <strong>ì ˆëŒ€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</strong></li>
            <li>íƒˆí‡´ í›„ ê°™ì€ ì•„ì´ë””ë¡œ ì¬ê°€ì…ì€ ê°€ëŠ¥í•˜ì§€ë§Œ <strong>ê¸°ì¡´ ë°ì´í„°ëŠ” ë³µêµ¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</strong></li>
        </ul>
    </div>

    <!-- íƒˆí‡´ í¼ -->
    <div class="form-section">
        <h3 style="color: #dc3545; margin-top: 0;">ğŸ”’ ê³„ì • í™•ì¸</h3>
        
        <form method="post" id="deleteForm">
            {% csrf_token %}

            <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ -->
            <div class="form-group">
                <label for="{{ form.password.id_for_label }}" class="form-label">
                    í˜„ì¬ ë¹„ë°€ë²ˆí˜¸
                </label>
                {{ form.password }}
                {% if form.password.errors %}
                    {% for error in form.password.errors %}
                        <div class="error-message">âš ï¸ {{ error }}</div>
                    {% endfor %}
                {% endif %}
            </div>

            <!-- í™•ì¸ ì²´í¬ë°•ìŠ¤ -->
            <div class="checkbox-group">
                {{ form.confirm_delete }}
                <label for="{{ form.confirm_delete.id_for_label }}" class="checkbox-label">
                    {{ form.confirm_delete.label }}
                </label>
            </div>
            {% if form.confirm_delete.errors %}
                {% for error in form.confirm_delete.errors %}
                    <div class="error-message">âš ï¸ {{ error }}</div>
                {% endfor %}
            {% endif %}

            <!-- ì „ì²´ í¼ ì˜¤ë¥˜ -->
            {% if form.non_field_errors %}
                {% for error in form.non_field_errors %}
                    <div class="error-message">âš ï¸ {{ error }}</div>
                {% endfor %}
            {% endif %}

            <!-- ë²„íŠ¼ ê·¸ë£¹ -->
            <div style="text-align: center; margin-top: 30px;">
                <button type="submit" class="btn-danger">
                    ğŸ—‘ï¸ íšŒì› íƒˆí‡´ ì§„í–‰
                </button>
                <a href="{% url 'user_profile' %}" class="btn-secondary">
                    âŒ ì·¨ì†Œ
                </a>
            </div>
        </form>
    </div>

    <!-- ë§ˆì§€ë§‰ ì•ˆë‚´ -->
    <div style="margin-top: 30px; padding: 20px; background: #e7f3ff; border-radius: 8px; border-left: 5px solid #007bff; text-align: center;">
        <p style="color: #004085; margin: 0;">
            <strong>ğŸ’¡ ì ê¹!</strong> ê³„ì •ì„ ì‚­ì œí•˜ëŠ” ëŒ€ì‹  <strong>ì ì‹œ íœ´ì‹</strong>ì„ ì·¨í•´ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”?<br>
            ì–¸ì œë“ ì§€ ë‹¤ì‹œ ëŒì•„ì™€ ì£¼ì„¸ìš”! ğŸ¤—
        </p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('deleteForm');
    const passwordInput = document.getElementById('{{ form.password.id_for_label }}');
    const confirmCheckbox = document.getElementById('{{ form.confirm_delete.id_for_label }}');
    const submitBtn = form.querySelector('button[type="submit"]');

    // ì‹¤ì‹œê°„ í¼ ìœ íš¨ì„± ê²€ì‚¬
    function validateForm() {
        const password = passwordInput.value.trim();
        const confirmed = confirmCheckbox.checked;
        
        // ë‘˜ ë‹¤ ìœ íš¨í•œ ê²½ìš°ì—ë§Œ ë²„íŠ¼ í™œì„±í™”
        if (password && confirmed) {
            submitBtn.disabled = false;
            submitBtn.classList.remove('btn-disabled');
        } else {
            submitBtn.disabled = true;
            submitBtn.classList.add('btn-disabled');
        }
    }

    // ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    passwordInput.addEventListener('input', validateForm);
    confirmCheckbox.addEventListener('change', validateForm);

    // ì´ˆê¸° í¼ ìƒíƒœ ì„¤ì •
    validateForm();

    // í¼ ì œì¶œ ì‹œ ìµœì¢… í™•ì¸
    form.addEventListener('submit', function(e) {
        const password = passwordInput.value.trim();
        const confirmed = confirmCheckbox.checked;

        // í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê²€ì¦
        if (!password) {
            e.preventDefault();
            alert('ğŸ”’ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            passwordInput.focus();
            return false;
        }

        if (!confirmed) {
            e.preventDefault();
            alert('âš ï¸ íšŒì› íƒˆí‡´ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
            confirmCheckbox.focus();
            return false;
        }

        // ìµœì¢… í™•ì¸ ëŒ€í™”ìƒì
        if (!confirm('ğŸš¨ ì •ë§ë¡œ íšŒì›íƒˆí‡´ë¥¼ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!\nâš ï¸ ëª¨ë“  ê²Œì‹œê¸€ê³¼ ë°ì´í„°ê°€ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤!')) {
            e.preventDefault();
            return false;
        }

        // ì¤‘ë³µ ì œì¶œ ë°©ì§€
        if (submitBtn.disabled) {
            e.preventDefault();
            return false;
        }

        // í¼ ì œì¶œ ì¤‘ ë²„íŠ¼ ë¹„í™œì„±í™”
        submitBtn.disabled = true;
        submitBtn.innerHTML = 'ğŸ”„ ê³„ì • ì‚­ì œ ì¤‘...';
        submitBtn.classList.add('btn-processing');

        return true;
    });

    // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì‹œ ì—”í„°í‚¤ ì²˜ë¦¬
    passwordInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            if (!submitBtn.disabled) {
                form.dispatchEvent(new Event('submit'));
            }
        }
    });

    // í˜ì´ì§€ ì´íƒˆ ì‹œ ê²½ê³  (í¼ì— ë‚´ìš©ì´ ìˆì„ ë•Œ)
    window.addEventListener('beforeunload', function(e) {
        if (passwordInput.value.trim() || confirmCheckbox.checked) {
            e.preventDefault();
            e.returnValue = 'ì…ë ¥ëœ ë‚´ìš©ì´ ìˆìŠµë‹ˆë‹¤. ì •ë§ë¡œ í˜ì´ì§€ë¥¼ ë– ë‚˜ì‹œê² ìŠµë‹ˆê¹Œ?';
        }
    });
});
</script>
{% endblock %}