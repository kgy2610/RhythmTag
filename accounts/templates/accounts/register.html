{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë©”ì¸ í˜ì´ì§€</title>
    <link rel="stylesheet" href="{% static 'accounts/css/common.css' %}">
    <link rel="stylesheet" href="{% static 'accounts/css/register.css' %}">
</head>
<body>
    <div class="main-title">
        <img src="{% static 'accounts/images/logo.png' %}" alt="RhythmTag">
        <h1>#REGISTER</h1>
    </div>

    <div id="main-register">
        <form method="post" novalidate id="registerForm">
            {% csrf_token %}
            <div class="regs-option">
                <p class="regs-label"> {{ form.userid.label }} </p>
                <p>
                    {{ form.userid }}
                    {{ form.userid.errors }}
                </p>
            </div>
            <div class="regs-option">
                <p class="regs-label"> {{ form.password1.label }} </p>
                <div class="field-with-help">
                    {{ form.password1 }}
                    {{ form.password1.errors }}
                    <!-- ì¶”ê°€: ë¹„ë°€ë²ˆí˜¸ ê°€ì´ë“œ -->
                </div>
            </div>
            <div class="help-text">
                <small>
                    âœ… 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤<br>
                    âœ… ìˆ«ìë§Œìœ¼ë¡œëŠ” êµ¬ì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br>
                    âœ… ì•„ì´ë””ë‚˜ ë‹‰ë„¤ì„ì´ í¬í•¨ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br>
                    âœ… ì—°ì†ëœ ë¬¸ìë‚˜ ìˆ«ìëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤
                </small>
            </div>
            <div class="regs-option">
                <p class="regs-label"> {{ form.password2.label }} </p>
                <div class="field-with-help">
                    {{ form.password2 }}
                    {{ form.password2.errors }}
                    <div id="password-match-feedback"></div>
                </div>
            </div>
            <div class="regs-option">
                <p class="regs-label"> {{ form.name.label }} </p>
                <p>
                    {{ form.name }}
                    {{ form.name.errors }}
                </p>
            </div>
            <div class="regs-option">
                <p class="regs-label"> {{ form.phone.label }} </p>
                <p>
                    {{ form.phone }}
                    {{ form.phone.errors }}
                </p>
            </div>
            <div class="regs-option">
                <p class="regs-label"> {{ form.nickname.label }} </p>
                <p>
                    {{ form.nickname }}
                    {{ form.nickname.errors }}
                </p>
            </div>
            <div class="regs-option">
                <button type="submit">íšŒì›ê°€ì…</button>
            </div>
        </form>
    </div>
    <div id="login-btn">
        <a href="{% url 'login' %}">ë¡œê·¸ì¸</a>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('registerForm');
        const userid = document.getElementById('id_userid');
        const nickname = document.getElementById('id_nickname');
        const password1 = document.getElementById('id_password1');
        const password2 = document.getElementById('id_password2');
        const matchFeedback = document.getElementById('password-match-feedback');

        // ì‹¤ì‹œê°„ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
        password1.addEventListener('input', function() {
            const password = this.value;
            const useridValue = userid.value.toLowerCase();
            const nicknameValue = nickname.value.toLowerCase();
            
            // ê¸°ì¡´ í”¼ë“œë°± ì œê±°
            const existingFeedback = this.parentNode.querySelector('.password-feedback');
            if (existingFeedback) {
                existingFeedback.remove();
            }
            
            if (password.length > 0) {
                const feedback = document.createElement('div');
                feedback.className = 'password-feedback';
                
                let isValid = true;
                let message = '';
                
                if (password.length < 8) {
                    isValid = false;
                    message = 'âŒ ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤';
                } else if (password.length > 128) {
                    isValid = false;
                    message = 'âŒ ë¹„ë°€ë²ˆí˜¸ëŠ” 128ìë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                } else if (password.match(/^\d+$/)) {
                    isValid = false;
                    message = 'âŒ ìˆ«ìë§Œìœ¼ë¡œëŠ” êµ¬ì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                } else if (['password', '12345678', 'qwerty', 'abc123', 'abcdefg', 'password123'].includes(password.toLowerCase())) {
                    isValid = false;
                    message = 'âŒ ë„ˆë¬´ ê°„ë‹¨í•œ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤';
                } else if (['123', 'abc', 'qwe', 'asd'].some(seq => password.toLowerCase().includes(seq))) {
                    isValid = false;
                    message = 'âŒ ì—°ì†ëœ ë¬¸ìë‚˜ ìˆ«ìëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                } else if (useridValue && password.toLowerCase().includes(useridValue)) {
                    isValid = false;
                    message = 'âŒ ë¹„ë°€ë²ˆí˜¸ì— ì•„ì´ë””ê°€ í¬í•¨ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                } else if (nicknameValue && password.toLowerCase().includes(nicknameValue)) {
                    isValid = false;
                    message = 'âŒ ë¹„ë°€ë²ˆí˜¸ì— ë‹‰ë„¤ì„ì´ í¬í•¨ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                }
                
                if (isValid) {
                    feedback.innerHTML = 'âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤';
                    feedback.className += ' success-feedback';
                    this.style.borderColor = '#38a169';
                    this.style.backgroundColor = '#f0fff4';
                } else {
                    feedback.innerHTML = message;
                    feedback.className += ' korean-error';
                    this.style.borderColor = '#e53e3e';
                    this.style.backgroundColor = '#fff5f5';
                }
                
                this.parentNode.appendChild(feedback);
            } else {
                this.style.borderColor = '#C084FC';
                this.style.backgroundColor = 'whitesmoke';
            }
            
            // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ í™•ì¸ë„ ì—…ë°ì´íŠ¸
            checkPasswordMatch();
        });

        // ì•„ì´ë””ë‚˜ ë‹‰ë„¤ì„ ë³€ê²½ ì‹œì—ë„ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ì—…ë°ì´íŠ¸
        userid.addEventListener('input', function() {
            if (password1.value) {
                password1.dispatchEvent(new Event('input'));
            }
        });

        nickname.addEventListener('input', function() {
            if (password1.value) {
                password1.dispatchEvent(new Event('input'));
            }
        });

        // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ í™•ì¸
        function checkPasswordMatch() {
            if (password1.value && password2.value) {
                if (password1.value === password2.value) {
                    password2.style.borderColor = '#38a169';
                    password2.style.backgroundColor = '#f0fff4';
                    matchFeedback.innerHTML = '<div class="success-feedback">âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤</div>';
                } else {
                    password2.style.borderColor = '#e53e3e';
                    password2.style.backgroundColor = '#fff5f5';
                    matchFeedback.innerHTML = '<div class="korean-error">âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</div>';
                }
            } else {
                matchFeedback.innerHTML = '';
                password2.style.borderColor = '#C084FC';
                password2.style.backgroundColor = 'whitesmoke';
            }
        }

        password2.addEventListener('input', checkPasswordMatch);

        // í¼ ì œì¶œ ì „ ìµœì¢… ê²€ì¦
        form.addEventListener('submit', function(e) {
            const password = password1.value;
            const userid_val = userid.value.toLowerCase();
            const nickname_val = nickname.value.toLowerCase();

            // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ í™•ì¸
            if (password1.value !== password2.value) {
                e.preventDefault();
                alert('ğŸ”„ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                password2.focus();
                return false;
            }

            // ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ í™•ì¸
            if (password.length < 8) {
                e.preventDefault();
                alert('âš ï¸ ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                password1.focus();
                return false;
            }

            // ìˆ«ìë§Œìœ¼ë¡œ êµ¬ì„± í™•ì¸
            if (password.match(/^\d+$/)) {
                e.preventDefault();
                alert('âš ï¸ ë¹„ë°€ë²ˆí˜¸ëŠ” ìˆ«ìë§Œìœ¼ë¡œ êµ¬ì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                password1.focus();
                return false;
            }

            // ê°„ë‹¨í•œ ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            const commonPasswords = ['password', '12345678', 'qwerty', 'abc123', 'abcdefg', 'password123'];
            if (commonPasswords.includes(password.toLowerCase())) {
                e.preventDefault();
                alert('âš ï¸ ë„ˆë¬´ ê°„ë‹¨í•œ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤. ë” ë³µì¡í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
                password1.focus();
                return false;
            }

            // ì—°ì† ë¬¸ì í™•ì¸
            if (['123', 'abc', 'qwe', 'asd'].some(seq => password.toLowerCase().includes(seq))) {
                e.preventDefault();
                alert('âš ï¸ ì—°ì†ëœ ë¬¸ìë‚˜ ìˆ«ìëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                password1.focus();
                return false;
            }

            // ì•„ì´ë”” í¬í•¨ í™•ì¸
            if (userid_val && password.toLowerCase().includes(userid_val)) {
                e.preventDefault();
                alert('âš ï¸ ë¹„ë°€ë²ˆí˜¸ì— ì•„ì´ë””ê°€ í¬í•¨ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                password1.focus();
                return false;
            }

            // ë‹‰ë„¤ì„ í¬í•¨ í™•ì¸
            if (nickname_val && password.toLowerCase().includes(nickname_val)) {
                e.preventDefault();
                alert('âš ï¸ ë¹„ë°€ë²ˆí˜¸ì— ë‹‰ë„¤ì„ì´ í¬í•¨ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                password1.focus();
                return false;
            }

            // ëª¨ë“  ê²€ì¦ í†µê³¼
            if (confirm('âœ… íšŒì›ê°€ì…ì„ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return true;
            } else {
                e.preventDefault();
                return false;
            }
        });
    });
    </script>
    </body>
</html>