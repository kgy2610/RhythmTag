<!-- accounts/templates/accounts/profile_password_update.html -->
{% extends 'blog/base.html' %}
{% load static %}

{% block title %}ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ - RhythmTag{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'accounts/css/profile_password_update.css' %}">
{% endblock %}

{% block content %}
<div class="password-update-container">
    <div class="title-section">
        <h1>#ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h1>
        <p class="subtitle">ë³´ì•ˆì„ ìœ„í•´ í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
    </div>

    <div class="form-container">
        <form method="post" id="passwordForm">
            {% csrf_token %}

            <!-- í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ -->
            <div class="form-group">
                <label for="{{ form.old_password.id_for_label }}" class="form-label">
                    ğŸ”’ í˜„ì¬ ë¹„ë°€ë²ˆí˜¸
                </label>
                {{ form.old_password }}
                {% if form.old_password.errors %}
                    {% for error in form.old_password.errors %}
                        <div class="korean-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}
            </div>

            <!-- ìƒˆ ë¹„ë°€ë²ˆí˜¸ -->
            <div class="form-group">
                <label for="{{ form.new_password1.id_for_label }}" class="form-label">
                    ğŸ”‘ ìƒˆ ë¹„ë°€ë²ˆí˜¸
                </label>
                {{ form.new_password1 }}
                {% if form.new_password1.errors %}
                    {% for error in form.new_password1.errors %}
                        <div class="korean-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}
            </div>

            <!-- ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ -->
            <div class="form-group">
                <label for="{{ form.new_password2.id_for_label }}" class="form-label">
                    ğŸ” ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸
                </label>
                {{ form.new_password2 }}
                {% if form.new_password2.errors %}
                    {% for error in form.new_password2.errors %}
                        <div class="korean-error">{{ error }}</div>
                    {% endfor %}
                {% endif %}
                <div id="password-match-feedback"></div>
            </div>

            <div class="help-text">
                <small>
                    âœ… 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤<br>
                    âœ… ìˆ«ìë§Œìœ¼ë¡œëŠ” êµ¬ì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br>
                    âœ… ì•„ì´ë””ë‚˜ ë‹‰ë„¤ì„ì´ í¬í•¨ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br>
                    âœ… ì—°ì†ëœ ë¬¸ìë‚˜ ìˆ«ìëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤
                </small>
            </div>

            <!-- ì „ì²´ í¼ ì˜¤ë¥˜ -->
            {% if form.non_field_errors %}
                {% for error in form.non_field_errors %}
                    <div class="korean-error">{{ error }}</div>
                {% endfor %}
            {% endif %}

            <!-- ë²„íŠ¼ ê·¸ë£¹ -->
            <div class="button-group">
                <button type="submit" class="btn-primary">
                    âœ… ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
                </button>
                <button type="button" class="btn-secondary" onclick="window.location.href='{% url 'user_profile' %}'">
                    âŒ ì·¨ì†Œ
                </button>
            </div>
        </form>
    </div>

    <!-- ë³´ì•ˆ ì•Œë¦¼ -->
    <div class="security-notice">
        <h3>ğŸ›¡ï¸ ë³´ì•ˆ ì•Œë¦¼</h3>
        <ul>
            <li>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í›„ ëª¨ë“  ê¸°ê¸°ì—ì„œ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ê²Œ ë©ë‹ˆë‹¤</li>
            <li>ì •ê¸°ì ì¸ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì„ ê¶Œì¥í•©ë‹ˆë‹¤</li>
            <li>ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì™€ ë™ì¼í•œ ë¹„ë°€ë²ˆí˜¸ëŠ” ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”</li>
        </ul>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('passwordForm');
    const newPassword1 = document.getElementById('{{ form.new_password1.id_for_label }}');
    const newPassword2 = document.getElementById('{{ form.new_password2.id_for_label }}');
    const matchFeedback = document.getElementById('password-match-feedback');

    // ì‹¤ì‹œê°„ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
    newPassword1.addEventListener('input', function() {
        const password = this.value;
        
        // ê¸°ì¡´ í”¼ë“œë°± ì œê±°
        const existingFeedback = this.parentNode.querySelector('.password-feedback');
        if (existingFeedback) {
            existingFeedback.remove();
        }
        
        if (password.length > 0) {
            const feedback = document.createElement('div');
            feedback.className = 'password-feedback';
            feedback.style.cssText = 'margin-top: 8px; padding: 8px; border-radius: 4px; font-size: 14px;';
            
            if (password.length < 8) {
                feedback.innerHTML = 'âŒ ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤';
                feedback.className += ' korean-error';
            } else if (password.match(/^\d+$/)) {
                feedback.innerHTML = 'âŒ ìˆ«ìë§Œìœ¼ë¡œëŠ” êµ¬ì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                feedback.className += ' korean-error';
            } else {
                feedback.innerHTML = 'âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤';
                feedback.className += ' success-feedback';
            }
            
            this.parentNode.appendChild(feedback);
        }
        
        // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ í™•ì¸ë„ ì—…ë°ì´íŠ¸
        checkPasswordMatch();
    });

    // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ í™•ì¸
    function checkPasswordMatch() {
        if (newPassword1.value && newPassword2.value) {
            if (newPassword1.value === newPassword2.value) {
                newPassword2.style.borderColor = '#38a169';
                newPassword2.style.backgroundColor = '#f0fff4';
                matchFeedback.innerHTML = '<div class="success-feedback">âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤</div>';
            } else {
                newPassword2.style.borderColor = '#e53e3e';
                newPassword2.style.backgroundColor = '#fff5f5';
                matchFeedback.innerHTML = '<div class="korean-error">âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</div>';
            }
        } else {
            matchFeedback.innerHTML = '';
            newPassword2.style.borderColor = '#C084FC';
            newPassword2.style.backgroundColor = 'whitesmoke';
        }
    }

    newPassword2.addEventListener('input', checkPasswordMatch);

    // í¼ ì œì¶œ í™•ì¸
    form.addEventListener('submit', function(e) {
        if (newPassword1.value !== newPassword2.value) {
            e.preventDefault();
            alert('ğŸ”„ ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            return false;
        }

        if (newPassword1.value.length < 8) {
            e.preventDefault();
            alert('âš ï¸ ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
            return false;
        }

        if (confirm('ğŸ”’ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            return true;
        } else {
            e.preventDefault();
            return false;
        }
    });
});
</script>
{% endblock %}