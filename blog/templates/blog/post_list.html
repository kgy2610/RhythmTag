<!-- blog/templates/blog/post_list.html -->

{% extends 'blog/base.html' %}
{% load static %}

{% block title %}ê²Œì‹œê¸€ ëª©ë¡ - RhythmTag{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'blog/css/post_list.css' %}">
{% endblock %}

{% block content %}
    <!-- ë©”ì‹œì§€ í‘œì‹œ -->
    {% if messages %}
    <div class="message-container">
        {% for message in messages %}
        <div class="message message-{{ message.tags }}">
            {{ message }}
            <button class="message-close" onclick="this.parentElement.remove()">&times;</button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- ê²€ìƒ‰ì°½ -->
    <div class="search-bar">
        <form method="get">
            <input type="text" name="search" value="{{ request.GET.search }}" 
                   placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”(ì œëª©, íƒœê·¸)">
            <input type="hidden" name="filter" value="{{ current_filter }}">
        </form>
    </div>

    <!-- ë¸”ë¡œê·¸ ì´ë¦„ -->
    <div style="text-align: center; margin: 30px 0;">
        <h2 class="blog-name">{{ blog_name }}</h2>
    </div>

    <!-- ì¹´í…Œê³ ë¦¬ ë©”ë‰´ì™€ ìƒˆ ê¸€ ì“°ê¸° -->
    <div id="category">
        <div class="category-btn">
            <input type="radio" id="my" name="filter" {% if current_filter == 'my' %}checked{% endif %}>
            <label for="my" onclick="location.href='?filter=my'">ë‚´ê°€ ì‘ì„±í•œ ê¸€</label>
            
            <input type="radio" id="follow" name="filter" {% if current_filter == 'follow' %}checked{% endif %}>
            <label for="follow" onclick="location.href='?filter=follow'">íŒ”ë¡œì›Œ/íŒ”ë¡œì‰</label>
            
            <input type="radio" id="famous" name="filter" {% if current_filter == 'famous' %}checked{% endif %}>
            <label for="famous" onclick="location.href='?filter=famous'">ì¸ê¸°ê°€ ë§ì€ ê¸€</label>
        </div>
        <div class="write">
            <p><a href="{% url 'post_write' %}">ìƒˆ ê¸€ ì“°ê¸°</a></p>
        </div>
    </div>

    <!-- ê²Œì‹œê¸€ ëª©ë¡ ë˜ëŠ” ì•ˆë‚´ ë©”ì‹œì§€ -->
    {% if current_filter == 'my' and user.is_authenticated %}
        <!-- "ë‚´ê°€ ì‘ì„±í•œ ê¸€" íƒ­ -->
        {% if not user_has_blog %}
            <!-- ë¸”ë¡œê·¸ê°€ ì—†ëŠ” ê²½ìš° -->
            <div class="no-content-message">
                <h3>ë¸”ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.</h3>
                <p>ë‚˜ë§Œì˜ ë¸”ë¡œê·¸ë¥¼ ë§Œë“¤ì–´ ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                <a href="{% url 'blog_create' %}" class="create-blog-btn">ğŸ“ ë¸”ë¡œê·¸ ìƒì„±í•˜ê¸°</a>
            </div>
        {% elif not posts %}
            <!-- ë¸”ë¡œê·¸ëŠ” ìˆì§€ë§Œ ë‚´ê°€ ì“´ ê¸€ì´ ì—†ëŠ” ê²½ìš° -->
            <div class="no-content-message">
                <h3>ì•„ì§ ì‘ì„±í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</h3>
                <p>ì²« ë²ˆì§¸ ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                <a href="{% url 'post_write' %}" class="write-first-btn">âœï¸ ì²« ë²ˆì§¸ ê¸€ ì‘ì„±í•˜ê¸°</a>
            </div>
        {% else %}
            <!-- ë‚´ê°€ ì“´ ê¸€ ëª©ë¡ í‘œì‹œ -->
            <div id="post-list">
                {% for post in posts %}
                <div class="post-card">
                    <a href="{% url 'post_detail' post.pk %}">
                        <div id="thumnail">
                            {% if post.thumbnail %}
                                <img src="{{ post.thumbnail.url }}" alt="{{ post.title }}">
                            {% else %}
                                <div style="background-color: whitesmoke; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #999;">ì¸ë„¤ì¼ ì—†ìŒ</div>
                            {% endif %}
                        </div>
                        <div id="info">
                            <span>{{ post.title|truncatechars:20 }}</span>
                            <div id="likes">â¤ï¸ {{ post.like_count }}</div>
                        </div>
                        <div id="post-content">
                            {{ post.content|truncatewords:10 }}
                        </div>
                        <div id="tags">
                            {% for tag in post.tags.all %}
                                #{{ tag.name }} 
                            {% endfor %}
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        {% endif %}
    {% else %}
        <!-- ë‹¤ë¥¸ íƒ­ë“¤ -->
        {% if not posts %}
            <div class="no-content-message">
                <h3>ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</h3>
                <p>ì²« ë²ˆì§¸ ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
            </div>
        {% else %}
            <div id="post-list">
                {% for post in posts %}
                <div class="post-card">
                    <a href="{% url 'post_detail' post.pk %}">
                        <div id="thumnail">
                            {% if post.thumbnail %}
                                <img src="{{ post.thumbnail.url }}" alt="{{ post.title }}">
                            {% else %}
                                <div style="background-color: whitesmoke; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #999;">ì¸ë„¤ì¼ ì—†ìŒ</div>
                            {% endif %}
                        </div>
                        <div id="info">
                            <span>{{ post.title|truncatechars:20 }}</span>
                            <div id="likes">â¤ï¸ {{ post.like_count }}</div>
                        </div>
                        <div id="post-content">
                            {{ post.content|truncatewords:10 }}
                        </div>
                        <div id="tags">
                            {% for tag in post.tags.all %}
                                #{{ tag.name }} 
                            {% endfor %}
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endif %}
    {% endblock %}

    <script>
    setTimeout(function() {
        const messageContainer = document.querySelector('.message-container');
        if (messageContainer) {
            messageContainer.style.opacity = '0';
            setTimeout(() => messageContainer.remove(), 300);
        }
    }, 3000);
    </script>
</body>
</html>