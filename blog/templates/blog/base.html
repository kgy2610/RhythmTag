{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}RhythmTag{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'blog/css/common.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- 공통 헤더 -->
    <header>
        <div id="header">
            <div id="logo">
                <img src="{% static 'blog/images/logo.png' %}" alt="RhythmTag" onclick="location.href='{% url 'post_list' %}'">
            </div>
            <div class="menu">
                {% if user.is_authenticated %}
                    <!-- 로그인된 사용자 메뉴 -->
                    <div id="user" class="dropdown">
                        <img src="{% static 'blog/images/user.png' %}" alt="내 정보" onclick="toggleUserMenu()">
                        <div id="user-dropdown" class="dropdown-content">
                            <a href="{% url 'user_profile' %}">내 정보</a>
                            <a href="{% url 'post_write' %}">글 쓰기</a>
                            <form method="post" action="{% url 'logout' %}" style="margin: 0;">
                                {% csrf_token %}
                                <button type="submit" class="logout-btn">로그아웃</button>
                            </form>
                        </div>
                    </div>
                {% else %}
                    <!-- 비로그인 사용자 -->
                    <div id="user">
                        <img src="{% static 'blog/images/user.png' %}" alt="로그인" onclick="location.href='{% url 'login' %}'">
                    </div>
                {% endif %}
                
                <div id="menu" class="dropdown">
                    <img src="{% static 'blog/images/menu.png' %}" alt="메뉴" onclick="toggleMainMenu()">
                    <div id="menu-dropdown" class="dropdown-content">
                        <a href="{% url 'post_list' %}">홈</a>
                        {% if user.is_authenticated %}
                            <a href="{% url 'post_write' %}">글 쓰기</a>
                            <a href="{% url 'user_profile' %}">내 정보</a>
                        {% else %}
                            <a href="{% url 'login' %}">로그인</a>
                            <a href="{% url 'register' %}">회원가입</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <hr>
    </header>

    <!-- 메시지 표시 -->
    {% if messages %}
        <div id="messages">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- 각 페이지별 내용 -->
    <main>
        {% block content %}
        {% endblock %}
    </main>

    <!-- 공통 JavaScript -->
    <script>
        // 사용자 메뉴 토글
        function toggleUserMenu() {
            const dropdown = document.getElementById('user-dropdown');
            const isVisible = dropdown.style.display === 'block';
            
            // 모든 드롭다운 닫기
            closeAllDropdowns();
            
            // 현재 드롭다운 토글
            if (!isVisible) {
                dropdown.style.display = 'block';
            }
        }

        // 메인 메뉴 토글
        function toggleMainMenu() {
            const dropdown = document.getElementById('menu-dropdown');
            const isVisible = dropdown.style.display === 'block';
            
            // 모든 드롭다운 닫기
            closeAllDropdowns();
            
            // 현재 드롭다운 토글
            if (!isVisible) {
                dropdown.style.display = 'block';
            }
        }

        // 모든 드롭다운 닫기
        function closeAllDropdowns() {
            const dropdowns = document.querySelectorAll('.dropdown-content');
            dropdowns.forEach(dropdown => {
                dropdown.style.display = 'none';
            });
        }

        // 외부 클릭 시 드롭다운 닫기
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.dropdown')) {
                closeAllDropdowns();
            }
        });

        // 로고 클릭 커서 스타일
        document.querySelector('#logo img').style.cursor = 'pointer';
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>